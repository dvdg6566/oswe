{"a":[],"q":[{"s":"#mail_info","m":["unblock"],"a":[[]]},{"s":"#messageList div#primary_content div#mail_info:first","m":["html"],"a":[[" \n\n<form id='composeMessage'>\n\t\n\t\t<input type=\"hidden\" name=\"tabId\" value=\"messageList\" \/>\n\t<input type=\"hidden\" name=\"composeID\" value=\"messageList\" \/>\n\t\t<input type='hidden' name='emailFrom' id='emailFrom' value=''\/>\n\t<input type='hidden' name='hiddenReplyToSource' id='hiddenReplyToSource' value='root@atutor'\/>\n\t<input type='hidden' name='hiddenReplyAllToSource' id='hiddenReplyAllToSource' value='&lt;dlv@offsec.local&gt;'\/>\n\t<input type='hidden' name='hiddenReplyAllCcSource' id='hiddenReplyAllCcSource' value=''\/>\n\t\n\t<input type=\"hidden\" name=\"inlineComposer\" id=\"inlineComposer\" value=\"true\" \/>\n\t<input type=\"hidden\" name=\"relatedMessageFolder\" id=\"relatedMessageFolder\" value=\"INBOX\" \/>\n\t<input type=\"hidden\" name=\"relatedMessageUID\" id=\"relatedMessageUID\" value=\"8\" \/>\n\t<input type=\"hidden\" name=\"relatedMessageMessageId\" id=\"relatedMessageMessageId\" value=\"<47c00669a92a0e50a18fbccd5d0a79f7@atutor>\" \/>\n\t<input type=\"hidden\" name=\"relatedMessageResponseType\" class=\"relatedMessageResponseType\" value=\"reply\" \/>\n\t<input type=\"hidden\" name=\"relatedDraftUID\" class=\"relatedDraftUID\" value=\"\" \/>\n\t<div id=\"primary_content_inner\">\n\t\t<div id=\"message_wrapper\">\n\t\t\t\t\n\t<div class=\"message\">\n\t\t<div class=\"message_outer\">\n\t\t\t<div class=\"message_inner\">\n\t\t\t\t\n\t\t\t\t\t\t\t\t<div id='8' class=\"details\" onClick=\"toggleThread(this, '\/index.php\/mail\/viewmessage\/index\/folder\/INBOX\/uniqueId\/8\/inline\/true\/messagePanelContextName\/messageList')\">\n\t\t\t\t\t\t\t\t\t<h3>root@atutor<\/h3>\n\n\t\t\t\t\t<div class=\"meta\">\n\t\t\t\t\t\t<div style=\"position: relative; float: left; padding: 6px 10px 0pt 0pt;\">\n\t\t\t\t\t    \t\t\t\t\t\t<h4 class=\"received dateFormat1\" title=\"Wed, 6 Dec 2023 10:08:44 -0500\">\n\t\t\t\t\t\t\t1 min ago\t\t\t\t\t\t<\/h4>\t\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\n\t\t               \t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass=\"button nodeActionsButtons\" \n\t\t\t\t\t\t\tto='&lt;dlv@offsec.local&gt;' \n\t\t\t\t\t\t\treplyto='root@atutor' \n\t\t\t\t\t\t\treplyallto='&lt;dlv@offsec.local&gt;' \n\t\t\t\t\t\t\treplyallcc='' \n\t\t\t\t\t\t\tuniqueid='8' \n\t\t\t\t\t\t\tsent='Wed, 6 Dec 2023 10:08:44 -0500' \n\t\t\t\t\t\t\tsubjectOriginal='ATutor Server: Forgot Password' \n\t\t\t\t\t\t\tsubjectReply='Re: ATutor Server: Forgot Password' \n\t\t\t\t\t\t\trelatedMessageMessageId='<47c00669a92a0e50a18fbccd5d0a79f7@atutor>'\n\t\t\t\t\t\t\tfolder='INBOX' \n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div style=\"float:left; margin-right:5px;\">\n\t\t\t\t\t\t\t\t<a id='nodeInfoAnchor' href=\"#\" title=\"Display message information\"><strong><img src=\"\/images\/icons\/info.png\" alt=\"Info\" style=\"padding-top: 4px;\"\/><\/strong><\/a>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<a id='nodeReplyAnchor' href=\"#\"><strong><img src=\"\/images\/icons\/reply-icon.png\" alt=\"Reply\" style=\"padding-top: 4px;\"\/><\/strong><\/a>\n\t\t\t\t\t\t\t<div class=\"ReplyDrop\">\n\t\t\t               \t\t<a class=\"arrow\">â–¼<\/a>\n\t\t\t\t\t\t\t\t<ul class=\"nodeActionsDropdown\" style=\"display:none;\">\n\t\t\t\t\t\t\t\t\t<li id='replyall'><a href=\"#\">Reply All<\/a><\/li>\n\t\t\t\t\t\t\t\t\t<li id='forward'><a href=\"#\">Forward<\/a><\/li>\n\t\t\t\t\t\t\t\t\t<li id='forwardAsAttachment'><a href=\"#\">Forward Attachment<\/a><\/li>\n\t\t\t\t\t\t\t\t\t<li id='markasread'><a href=\"#\">Mark as Read<\/a><\/li>\n\t\t\t\t\t\t\t\t\t<li id='markasunread'><a href=\"#\">Mark as Unread<\/a><\/li>\n\t\t\t\t\t\t\t\t\t<li id='addToAddressbook'><a href=\"#\">Add to Contacts<\/a><\/li>\n\t\t\t\t\t\t\t\t\t<li id='viewHeaders' state=\"hide\"><a href=\"#\">View Headers<\/a><\/li>\n\t\t\t\t\t\t\t\t\t<li id='print'><a href=\"#\">Print&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<\/a><\/li>\n\t\t\t\t\t\t\t\t\t<li id='download' class=\"bottom\"><a href=\"#\">Download Email<\/a><\/li>\n\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t               \t<\/div>\n\t               \t\t\t\t\t\t\t               \t\n\t            <\/div>\n                <div class=\"body\">\n\t\n\t                <div class=\"messageHeadersInfo triangle-isosceles top\" style=\"display:none;\">\n\t\t\t\t\t\t<div><strong>From <\/strong>root@atutor<\/div>\t\t\t\t\t\t<div><strong>To <\/strong>dlv@offsec.local<\/div>\t\t\t\t\t\t\t\t\t\t\t\t<div><strong>Date <\/strong>Wed, 6 Dec 2023 10:08:44 -0500<\/div>\t\t\t\t\t\t<div><strong>Subject <\/strong>ATutor Server: Forgot Password<\/div>\t\t\t\t\t\t<div><strong>Client <\/strong>PHPMailer [version 1.73]<\/div>\t\t\t\t\t<\/div>\n\t\t\t\t\t\n\t\t\t\t\t<div class=\"messageHeadersRaw triangle-isosceles top\" style=\"display:none;\">\n\t\t\t\t\t\t<strong>Return-path <\/strong>&nbsp;<span id=\"header-return-path\">&lt;www-data@offsec.local&gt;<\/span><br \/>\n<strong>Envelope-to <\/strong>&nbsp;<span id=\"header-envelope-to\">dlv@offsec.local<\/span><br \/>\n<strong>Received <\/strong><br \/><div id=\"header-received\">\n      from [192.168.208.103] (helo=atutor) by atmail with esmtp (Exim 4.76) (envelope-from &lt;www-data@offsec.local&gt;) id 1rAtW0-000189-Hh for dlv@offsec.local; Wed, 06 Dec 2023 08:08:44 -0700<br \/>\n      by atutor (Postfix, from userid 33) id D7952C245; Wed,  6 Dec 2023 10:08:44 -0500 (EST)<\/div><br \/>\n<strong>Date <\/strong>&nbsp;<span id=\"header-date\">Wed, 6 Dec 2023 10:08:44 -0500<\/span><br \/>\n<strong>To <\/strong>&nbsp;<span id=\"header-to\">dlv@offsec.local<\/span><br \/>\n<strong>From <\/strong>&nbsp;<span id=\"header-from\">root@atutor<\/span><br \/>\n<strong>Subject <\/strong>&nbsp;<span id=\"header-subject\">ATutor Server: Forgot Password<\/span><br \/>\n<strong>Message-id <\/strong>&nbsp;<span id=\"header-message-id\">&lt;47c00669a92a0e50a18fbccd5d0a79f7@atutor&gt;<\/span><br \/>\n<strong>X-priority <\/strong>&nbsp;<span id=\"header-x-priority\">3<\/span><br \/>\n<strong>X-mailer <\/strong>&nbsp;<span id=\"header-x-mailer\">PHPMailer [version 1.73]<\/span><br \/>\n<strong>Mime-version <\/strong>&nbsp;<span id=\"header-mime-version\">1.0<\/span><br \/>\n<strong>Content-type <\/strong>&nbsp;<span id=\"header-content-type\">text\/plain; charset=&quot;utf-8&quot;<\/span><br \/>\n<strong>Content-transfer-encoding <\/strong>&nbsp;<span id=\"header-content-transfer-encoding\">quoted-printable<\/span><br \/>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t<div class=\"messageBody\" style=\"display: none; visibility: hidden;\">\nDear Offensive,&lt;br \/&gt;\r\n&lt;br \/&gt;\r\nYour login name is teacher.&lt;br \/&gt;\r\n&lt;br \/&gt;\r\nTo set a new password, follow the link below. &lt;br \/&gt;\r\n&lt;br \/&gt;\r\nhttp:\/\/atutor\/ATutor\/password_reminder.php?id=1&amp;amp;g=19697&amp;amp;h=67c5b839df049b9&lt;br \/&gt;\r\n&lt;br \/&gt;\r\n(If this link does not take you to the site, copy and paste it into the address bar of your internet browser)&lt;br \/&gt;\r\n&lt;br \/&gt;\r\nThe link will become invalid after 2 days.&lt;br \/&gt;\r\n&lt;br \/&gt;\r\n----------------------------------------------&lt;br \/&gt;\r\nSent via an ATutor system at http:\/\/atutor\/ATutor\/&lt;br \/&gt;\r\nATutor home: http:\/\/atutor.ca&lt;br \/&gt;\r\n\n<\/div>\n<iframe class=\"messageIframe\" scrolling=\"no\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\" width=\"100%\" src=\"\/index.php\/default\/index\/blank\" onload=\"prepMessageIframe(this, '\/', '\/index.php\/mail\/viewmessage\/index\/folder\/INBOX\/uniqueId\/8\/inline\/true\/messagePanelContextName\/messageList')\"><\/iframe>\n\t\t\t\t<\/div> <!-- EO div class body -->\n\t\t\t\t\t\t\t\t\n\t\t\t<\/div> <!-- EO div class message_inner -->\n\t\t<\/div> <!-- EO div class message_outer -->\n\t<\/div> <!-- EO div class message --> \n\n \n\t\t\t<div class=\"message reply\">\n\t\t\t\t<div class=\"message_outer\">\n\t\t\t \t\t<div class=\"message_inner\">\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t   \t\t\t<div class=\"details replyDetails\" >\n\t\t\t\t\t\t\t<h3 class=\"collapse\" style=\"height: 100%;\">\n\t\t\t\t\t\t\t\t<div id='recipientsSection' style=\"display:none;\">\n\t\t\t\t\t\t\t\t\t<div id='replyTo'>\n\t\t\t\t\t\t\t\t\t\t<div class=\"leftreply\">\n\t\t\t\t\t\t\t\t\t\t\t<strong>To:<\/strong>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"rightreply\">\n\t\t\t\t\t\t\t\t\t\t\t<div id=\"form_to\">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"emailTo\" value='' id=\"emailTo\" \/>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div id='reply'>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"leftreply\">\n\t\t\t\t\t\t\t\t\t\t\t\t<strong>Cc: <\/strong>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"rightreply\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"form_cc\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"emailCc\" value='' id=\"emailCc\" \/>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div id='replyBcc' style=\"display: none\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"leftreply\">\n\t\t\t\t\t\t\t\t\t\t\t\t<strong>Bcc: <\/strong>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"rightreply\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"form_bcc\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"emailBcc\" value='' id=\"emailBcc\" \/>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div id='subject' style=\"display:none\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"leftreply\">\n\t\t\t\t\t\t\t\t\t\t\t<strong>Subject:<\/strong>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"rightreply\">\n\t\t                                \t<div id=\"subjectHolder\">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" id=\"emailSubject\" name=\"emailSubject\" value='Re: ATutor Server: Forgot Password'\/>\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<div id='replyAttach'>\n\t\t\t\t\t\t\t\t\t\t<div class=\"leftreply\">\n\t\t\t\t\t\t\t\t\t\t\t<strong>Files:<\/strong>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"rightreply\">\n\t\t                                \t<div id=\"composerAttachmentsHolder\" numberOfAttachmentsCurrentlyIUploading=\"0\"><\/div>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class=\"YourReply\"><strong style=\"color:#575757;\">Options:<\/strong>\n\t\t\t\t\t    \t\t\t<input type=\"checkbox\" id=\"replyAll\" \/>Reply To All\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t<span id='showRecipientsButton'> | <a href=\"#\">Show Recipients<\/a><\/span>\n\t\t\t\t\t\t\t\t\t\t<div style=\"display: inline\" id=\"editSubjectLink\"> | <a id=\"editSubject\" href=\"#\">Edit Subject<\/a><\/div>\n\t\t\t\t\t\t\t\t\t\t<div style=\"display: inline\" id=\"addBccLink\"> | <a id=\"addBcc\" href=\"#\">Add Bcc<\/a><\/div>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t<\/div>\n\t\t\t\n\t\t\t\t\t\t<span id='msgReply'><\/span>\n\t\t\t\t\t\t\n\t\t\t \t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/div> <!-- EO div class message reply -->\n\t\t<\/div> <!-- EO div id message_wrapper -->\n\t<\/div> <!-- EO div id primary_content_inner -->\n<\/form>\n\t\n\t\t\n\n<script type=\"text\/javascript\" language=\"JavaScript\">\n\nemailTo_handle = null;\nemailCc_handle = null;\nemailBcc_handle = null;\n\n$( function() \n{\n\tif('1' != 1)\n\t{\n\t\t$('.received',  '#messageList').each( function() { $(this).text(normalDate('1', $(this).attr('title'))) } );\n\t}\n\telse\n\t{\n\t\t$('.received',  '#messageList').each( function() { $(this).timeago($(this).attr('title')) } );\n\t}\n\tfunction updateTextBoxList( source, dest, autocomplete )\n\t{\n\t\tvar $messagePanelContextName = '#messageList';\n\t\tif( source == null )\n\t\t{\n\t\t\t\/\/ no source defined, we are most probably clearing the box\n\t\t\tsource_values = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsource_values = activeSplit($(source, $messagePanelContextName).attr('value'));\n\t\t}\n\t\treturn setTextBoxList( $(dest, $messagePanelContextName), source_values, autocomplete, 250, 50, 25, 2, '\/index.php\/mail\/' )\n\t}\n\n\t$('#msgReply', '#messageList').data('loaded', false);\n\t\n\t$('#msgReply', '#messageList').load(\n\t\t'\/index.php\/mail\/viewmessage\/reply\/messagePanelContextName\/messageList', \n\t\t{'forceIEReload':1701875328}, \n\t\tfunction (responseText, textStatus, XMLHttpRequest) \n\t\t{\n\t\n\t\t\t$('textarea.rte-zone-reply', '#messageList').attr('value', \"&nbsp;<div id='replyContainer' style='display:none;'><\/div>\");\n\t\t\t$('.rte-zone-reply', '#messageList').rte({ content_css_url: '\/css\/webmail.css', media_url: '\/images\/rte-light\/' })\n\t\n\t\t\t$('iframe.rte-zone-reply', '#messageList').contents().bind('click', function() \n\t\t\t{ \n\t\t\t\t$(this).unbind('click');\n\t\t\t\t$(this).contents().children(\"#replyContainer\").css('display', 'inline');\n\t    \n\t\t\t\t\/\/ perform actions in context of selected tab\n\t\t\t\t$nodeCheckList = $('#nodeReplyAnchor', '#messageList')\n\t\t\t\t$nodeCheckListLength = $nodeCheckList.length\n\t\t\t\tvar i = $nodeCheckListLength-1;\n\t\t\t\twhile( $($nodeCheckList[i]).parent().parent().parent().parent().children('.body').html().length < 20 && i >= 0  )\n\t\t\t\t\ti--\n                \n\t\t\t\tif( $($nodeCheckList[i]).length != 0)\n\t\t\t\t\t$($nodeCheckList[i]).trigger('click'); \/\/ trigger populating form with correct (last) thread nodes data (in case user had previously clicked reply to other node)\n\t\t\t\tresizeComposer('messageList', true);\t\t\n\t\t\t\t\n\t\t\t})\n\t\t\t$('#msgReply', '#messageList').data('loaded', true);\n\t\n\t\t}\n\t)\n\t\n\t$('.stronglastword', '#messageList').each( function() { $(this).stronglastword(); });\n\t\n\t$('#editSubject', '#messageList').bind('click', function() \n\t{\n\t\t\/\/only call message body and recipient prep if not done, else will nuke reply test when recalls prep\n\t\tif( !$('#recipientsSection', '#messageList').is(':visible') )\n\t\t\t$('#showRecipientsButton', '#messageList').click()\n\t\t$('#subject', '#messageList').show()\n\t\t$('#editSubjectLink', '#messageList').hide()\n\t\tresizeComposer('messageList', true)\n\t\t$('#emailSubject', '#messageList').focus();\n\t})\n\t\n\t\/\/set all <a href> links inside messageBody to open in a new window\n\t$('div.messageBody a', '#messageList').each( function() {\n\t\t\n\t\t\/\/$(this).attr('target', '_blank');\n\t\n\t})\n\t\n\t$('.showQuotedText').each( function() { $(this).unbind('click').bind('click', function() { return false }) });\n\t\n    \n\t\/\/ Set the max-width of image attachments for the 2pane & 3pane UI\n\tif( $(\"#mail_info li img\", '#messageList').length > 0 )\n\t{\n\t\t\n\t\t$(\"#mail_info li img\", '#messageList').each(function() \n\t\t{\n\n\t\t\t$(this).css('max-width', ($(\"#mail_info\").innerWidth() - 120) + \"px\");\n\t\t    \n\t\t});\n\t\t\n\t}   \n\telse\n\t{\n\t\t\n\t\t$(\"#primary_content li img\", '#messageList').each( function() \n\t\t{\n\n\t\t\t$(this).css('max-width', ($(\"#primary_header\").innerWidth() - 120) + \"px\");\n\t\t\t\n\t\t});\n\t\t\n\t}\n\t\n\n\t\n\t\/\/ Find all mailto: links and catch these to open in the message composer tab\n\ttry {\n\n\t\t$('div.messageBody a:mailto', '#messageList').each( function() {\n\n\t\t\t\/\/ We are a mailto?\n\t\t\tvar href = $(this).attr('href');\n\t\t\tif( !href )\n\t\t\t\treturn;\n\t\t\t\n\t\t\tif( !href.match(\/^mailto\\:\/) )\n\t\t\t\treturn;\n\n\t\t\t$(this).bind('click', function() \n\t\t\t{ \n\t\t\t\tto = $(this).attr('href').replace('mailto:', '')\n\t\t\t\topenNewComposerTab( {'to': to } );\n\t\t\t\treturn false;\n\t\t\t\n\t\t\t})\n\n\t\t})\n\t\t\n\t} catch(e) {\n\t\t\n\t}\n\t\n\tautocompleteList = new Array();\n\temailTo_handle = updateTextBoxList('#hiddenReplyToSource', '#emailTo', autocompleteList);\n\temailCc_handle = updateTextBoxList(null, '#emailCc', autocompleteList);\n\temailBcc_handle = updateTextBoxList(null, '#emailBcc', autocompleteList);\n\t\n\tif( $.jCacher.get('autocomplete') )\n\t{\n\t\tautocompleteList = $.jCacher.get('autocomplete').value\n\t\temailTo_handle.plugins['autocomplete'].setValues(autocompleteList)\n\t\temailCc_handle.plugins['autocomplete'].setValues(autocompleteList)\n\t\temailBcc_handle.plugins['autocomplete'].setValues(autocompleteList)\n\t\t\n\t\tif(autocompleteList.length >= 50)\n\t\t{\n\t\t\tvar settings = {\n\t\t\t\t\tplaceholder: false,\n\t\t\t\t\tcacheSize: 250,\n\t\t\t\t\tminRemoteLength: 2,\n\t\t\t\t\tqueryRemote: true,\n\t\t\t\t\tremote: {url: '\/index.php\/mail\/\/contacts\/autocomplete\/type\/global\/limit\/25'}\n\t\t\t\t};\n\t\t\temailTo_handle.plugins['autocomplete'].setOptions( settings );\t\n\t\t\temailCc_handle.plugins['autocomplete'].setOptions( settings );\n\t\t\temailBcc_handle.plugins['autocomplete'].setOptions( settings );\n\t\t}\n\t\t\n\t}\n\telse\n\t{\n\t\n\t\t$.ajax({\n\t\t\tcache:false, \n\t\t\turl: '\/index.php\/mail\/contacts\/autocomplete\/limit\/50', \n\t\t\tdataType: 'json', \n\t\t\tsuccess: function(r) \n\t\t\t{\n\t\t\t\t\/\/ above static lookup, enable dynamic lookup\n\t\t\t\tif(r.length >= 50)\n\t\t\t\t{\n\t\t\t\t\tvar settings = {\n\t\t\t\t\t\t\tplaceholder: false,\n\t\t\t\t\t\t\tcacheSize: 250,\n\t\t\t\t\t\t\tminRemoteLength: 2,\n\t\t\t\t\t\t\tqueryRemote: true,\n\t\t\t\t\t\t\tremote: {url: '\/index.php\/mail\/contacts\/autocomplete\/limit\/25'}\n\t\t\t\t\t\t};\n\t\t\t\t\temailTo_handle.plugins['autocomplete'].setOptions( settings );\n\t\t\t\t\temailCc_handle.plugins['autocomplete'].setOptions( settings );\n\t\t\t\t\temailBcc_handle.plugins['autocomplete'].setOptions( settings );\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tautocompleteList = r\n\t\t\t\t$.jCacher.add('autocomplete', r, 3600);\n\t\t\t\temailTo_handle.plugins['autocomplete'].setValues(r)\n\t\t\t\temailCc_handle.plugins['autocomplete'].setValues(r)\n\t\t\t\temailBcc_handle.plugins['autocomplete'].setValues(r)\n\t\t\t}\n\n\t\t})\n\t\t\n\t}\n\t\n\t\n\t\/\/hide and bind to show recipients section\n\t$('#showRecipientsButton', '#messageList').bind('click', function() \n\t{\n\t\t\/\/get last open node\n\t\t$nodeCheckList = $('#nodeReplyAnchor', '#messageList' )\n\t\t$nodeCheckListLength = $nodeCheckList.length\n\t\tvar i = $nodeCheckListLength-1;\n\t\twhile( $($nodeCheckList[i]).parent().parent().parent().parent().children('.body').html().length < 20 && i >= 0  )\n\t\t\ti--\n\t\tprepResponseFieldsAndContent( $($nodeCheckList[i]).parent() )\n\t\temailTo_handle = updateTextBoxList('#hiddenReplyToSource', '#emailTo', autocompleteList);\n\t\temailCc_handle = updateTextBoxList(null, '#emailCc', autocompleteList);\n\t\temailBcc_handle = updateTextBoxList(null, '#emailBcc', autocompleteList);\n\n\t\t$('#emailBcc', '#messageList').hide();\n\t\t$('#recipientsSection', '#messageList').show();\n\t\t$('#showRecipientsButton', '#messageList').hide();\n\t\n\t});\n\n\t$('#addBccLink', '#messageList').bind('click', function()  \n\t{ \n\t\tif( !$('#recipientsSection', '#messageList').is(':visible') ) \n\t\t{\n\t\t\t$('#showRecipientsButton', '#messageList').click()\n\t\t}\n\t\t$('#replyBcc', '#messageList').show(); \n\t\tresizeComposer('messageList', true);\n\t\t$('#addBccLink', '#messageList').hide(); \n\t\tsetTimeout('$(\"#form_bcc INPUT.textboxlist-bit-editable-input:last\", \"#messageList\").focus();',100); \/\/appears to be latency issue \n\t}); \n\n\t\/\/ Support clicking anywhere in the div box to get to the last \"bitbox selection\"\n\t$(\"#form_to\", '#messageList').bind('click', function() \n\t{\n\t\t$(\"#form_to INPUT.textboxlist-bit-editable-input:last\", '#messageList').focus();\n\t});\n\n\t$(\"#form_cc\", '#messageList').bind('click', function() \n\t{\n\t\t$(\"#form_cc INPUT.textboxlist-bit-editable-input:last\", '#messageList').focus();\n\t});\n\n\t$(\"#form_bcc\", '#messageList').bind('click', function() \n\t{\n\t\t$(\"#form_bcc INPUT.textboxlist-bit-editable-input:last\", '#messageList').focus();\n\t});\n\n\t\/\/$('#recipientsSection', '#messageList').hide()\n\n\t\/\/prepare node actions\n\t$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\tnodeActionsButtonsCloseTimer = null\n\n\t$('.arrow', '.nodeActionsButtons').each( function() {\n\n\t\t$(this).bind('click', function(e) {\n\t\t\tif( nodeActionsButtonsCloseTimer ) {\n\t\t\t\tclearTimeout(nodeActionsButtonsCloseTimer)\n\t\t\t\tnodeActionsButtonsCloseTimer = null \n\t\t\t}\n\t\t\t$('.nodeActionsDropdown', $(this).parent() ).show()\n\t\t\te.stopPropagation()\n\t\t})\n\t})\n\n\t$('.nodeActionsButtons').bind('mouseleave', function() \n\t{\n\t\n\t\tnodeActionsButtonsCloseTimer = setTimeout( \"$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\", 1000)\n\t\n\t})\n\n\t$('.nodeActionsButtons').bind('mouseenter', function() \n\t{\n\t\n\t\tif( nodeActionsButtonsCloseTimer ) \n\t\t{\n\t\t\n\t\t\tclearTimeout(nodeActionsButtonsCloseTimer)\n\t\t\tnodeActionsButtonsCloseTimer = null \n\t\t\n\t\t}\n\t\t\n\t})\n\t\n\t$('a#nodeImagesAnchor', '#messageList').bind('click', function(e) \n\t{\n\t\tparentDom =  $(this).parent().parent().parent().parent().parent();\n\t\tid = parentDom.children('div').attr('id');\n\t\tloadImages( parentDom, '\/index.php\/mail\/viewmessage\/index\/folder\/INBOX\/uniqueId\/' + id + '\/inline\/true\/messagePanelContextName\/messageList' );\n\t\te.stopPropagation();\n\t\t$(this).fadeOut('slow');\n\t\treturn false;\n\t});\n\t\n\t$('a#nodeInfoAnchor', '#messageList').bind('click', function(e) \n\t{\n\n\t\t$(this).parent().parent().parent().parent().parent().each( function() \n\t\t{\n\t\t\n\t\t\tif( $('.messageHeadersInfo:first', $(this) ).css('display') == 'none') \n\t\t\t{\n\t\t\n\t\t\t\t$('.messageHeadersInfo', $(this) ).slideDown('fast');\n\t\t\t\t$('.messageHeadersRaw', $(this)).hide();\n\t\t\t\t$('.nodeActionsButtons #viewHeaders a', $(this) ).html('View Headers');\n\t\t\t\t$('.nodeActionsButtons #viewHeaders a', $(this)).parent().attr('state','hide');\n\t\t\n\t\t\t}\n\t\t\telse \n\t\t\t{\n\t\t\n\t\t\t\t$('.messageHeadersInfo', $(this)).slideUp('fast');\t\t\n\t\t\t\t$('.messageHeadersRaw', $(this)).hide();\n\t\t\t\t$('.nodeActionsButtons #viewHeaders a', $(this)).html('View Headers');\n\t\t\t\t$('.nodeActionsButtons #viewHeaders a', $(this)).parent().attr('state','hide');\n\t\t\t\n\t\t\t}\n\t\t\n\t\t})\n\t\t\n\t\te.stopPropagation();\t\n\t\n\t});\n\t\n\n\t$('.nodeActionsButtons #addToAddressbook a', '#messageList').bind('click', function(e) \n\t{\t\n\t\t$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\t\temailToString = $('#hiddenReplyAllToSource', '#messageList').attr('value');\n\t\temailCcString = $('#hiddenReplyAllCcSource', '#messageList').attr('value');\n\t\t\/\/ Bcc intentionally left out - probably dont want bcc email addresses\n\t\tmimeAddresses = emailToString + ', ' + emailCcString\n\t\t$.php('\/index.php\/mail\/contacts\/addtoaddressbook', $.param({ 'mimeAddresses': emailToString+', '+emailCcString }) )\n\t\t$.jCacher.remove('autocomplete')\n\t\t$.jCacher.remove('autocomplete_global')\n\t\te.stopPropagation()\n\t})\n\t\n\t$('.nodeActionsButtons #nodeReplyAnchor', '#messageList').bind('click', function(e) \n\t{ \n\t\te.stopPropagation(); \n\t\tif( !$('#msgReply', '#messageList').data('loaded') )\n\t\t{\n\n\t\t\t$('#primary_header', '#messageList').addClass('loading')\n\t\t\tif( $('#msgReply', '#messageList').data('waitingForLoadedRetries') == undefined )\n\t\t\t\t$('#msgReply', '#messageList').data('waitingForLoadedRetries', 0)\n\t\t\twaitingForLoadedRetries = $('#msgReply', '#messageList').data('waitingForLoadedRetries')\n\t\t\tif( waitingForLoadedRetries < 10 )\n\t\t\t{\n\n\t\t\t\t$('#msgReply', '#messageList').data('waitingForLoadedRetries', waitingForLoadedRetries+1 )\n\t\t\t\tvar _this = this\n\t\t\t\tsetTimeout( function() { $(_this).trigger('click') }, 500)\n\t\t\t\treturn                                                                                                            \n\n\t\t\t}\n\n\t\t}\n\t\t$('#primary_header', '#messageList').removeClass('loading')\n\t\tprepResponseFieldsAndContent( $(this).parent() )\n\t\t$('.rte-zone-reply', '#messageList').rte_focus();\n\t\t\n\t\t\/\/ our emailto\/emailcc text boxes are updated in the replyAll checkbox bind below\n\t\t$('#replyAll', '#messageList').attr('checked', false).change();\n\t\tdraftAutosavingInitialize('#messageList', $( '#relatedMessageUID','#messageList').attr('value') )\n\t\tresizeComposer('messageList', false, false)\n\t})\n\n\t$('.nodeActionsButtons #replyall a', '#messageList').bind('click', function(e) \n\t{\n\t\te.stopPropagation(); \n\t\tif( !$('#msgReply', '#messageList').data('loaded') )\n\t\t{\n\n\t\t\t$('#primary_header', '#messageList').addClass('loading')\n\t\t\tif( $('#msgReply', '#messageList').data('waitingForLoadedRetries') == undefined )\n\t\t\t\t$('#msgReply', '#messageList').data('waitingForLoadedRetries', 0)\n\t\t\twaitingForLoadedRetries = $('#msgReply', '#messageList').data('waitingForLoadedRetries')\n\t\t\tif( waitingForLoadedRetries < 10 )\n\t\t\t{\n\n\t\t\t\t$('#msgReply', '#messageList').data('waitingForLoadedRetries', waitingForLoadedRetries+1 )\n\t\t\t\tvar _this = this\n\t\t\t\tsetTimeout( function() { $(_this).trigger('click') }, 500)\n\t\t\t\treturn                                                                                                            \n\n\t\t\t}\n\n\t\t}\n\t\t$('#primary_header', '#messageList').removeClass('loading')\n        $('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\t\tprepResponseFieldsAndContent( $(this).parent().parent().parent().parent() )\n\t\t$('.rte-zone-reply', '#messageList').rte_focus();\n\t\t\n\t\t\/\/ our emailto\/emailcc text boxes are updated in the replyAll checkbox bind below\n\t\t$('#replyAll', '#messageList').attr('checked', true).change();\n\t\tdraftAutosavingInitialize('#messageList', $( '#relatedMessageUID','#messageList').attr('value') )\n\t\tresizeComposer('messageList')\n\t\t\n\t})\n\t\n\t$('.nodeActionsButtons #forward a', '#messageList').bind('click', function(e) \n\t{\n\t\t$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\t\tvar uniqueId = $( $(this).parent().parent().parent().parent() ).attr('uniqueId')\n\t\tvar folder = $('#relatedMessageFolder', '#messageList').attr('value')\n\n\t\tforwardMessagesInNewTab( Array(uniqueId), folder )     \n\t\te.stopPropagation()\n\t\n\t})\n\t\n\t$('.nodeActionsButtons #forwardAsAttachment a', '#messageList').bind('click', function(e) \n\t{\n\t\t$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\t\tvar uniqueId = $( $(this).parent().parent().parent().parent() ).attr('uniqueId')\n\t\tvar folder = $('#relatedMessageFolder', '#messageList').attr('value')\n\n\t\tforwardMessagesInNewTab( Array(uniqueId), folder, true )     \n\t\te.stopPropagation()\n\t\n\t})\n\t\n\t$('.nodeActionsButtons #viewHeaders a', '#messageList').bind('click', function(e) \n\t{\n\t\t$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\t\tif( $(this).parent().attr('state') == 'hide' )\n\t\t{\n\t\t\t$(\".messageHeadersInfo\", '#messageList').hide();\n\t\t\t$(this).parent().attr('state','show')\n\t\t\t$(this).html('Hide Headers')\n\t\t\t$(this).parent().parent().parent().parent().parent().parent().parent().find('.messageHeadersRaw').slideDown('fast')\n\t\t}   \n\t\telse\n\t\t{\n\t\t\t$(this).parent().attr('state','hide')\n\t\t\t$(this).html('View Headers')\n\t\t\t$(this).parent().parent().parent().parent().parent().parent().parent().find('.messageHeadersRaw').slideUp('fast')\n\t\t}\n\t\t\n\t\te.stopPropagation()\n\t\treturn false;\n\t\n\t})\n\n\t$('.nodeActionsButtons #print a', '#messageList').bind('click', function(e) \n\t{\n\t\t$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\t\tprintDOMPart( $(this).parent().parent().parent().parent().parent().parent().parent().parent() )\n\t\te.stopPropagation()\n\t\treturn false;\n\t\n\t})\n\n\t$('.nodeActionsButtons #markasread a', '#messageList').bind('click', function(e) \n\t{\n\t\t$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\t\ticon = $(this).parent().parent().parent().parent().parent().children('#msgIcon')\n\t\t$(icon).removeClass('unread')\n\t\tif( !$(icon).hasClass('read') )\n\t\t\t$(icon).addClass('read')\n\t\tvar UID = $(this).parent().parent().parent().parent().attr('uniqueid')\n\t\tvar folder = $(this).parent().parent().parent().parent().attr('folder')\n\t\tvar action = moduleBaseUrl + '\/mail\/flagmessage\/flag\/seen\/appendFlag\/true\/selectFolder\/' + folder + '\/mailId\/' + UID\n\t\t$.php(action)\n\t\t\n\t\t\/\/now try flag in message lists\n\t\t$icon = false\n\t\tif( $('form#messagesListForm').length != 0 ) \/\/2 pane\n\t\t{\n\t\t\t\n\t\t\tif( $('#listFolder', 'form#messagesListForm').attr('value') == folder )\n\t\t\t\t$icon = $('#messageListTable', 'form#messagesListForm').find('tr#' + UID).find('#msgIcon')\n\t\t\t\n\t\t}\n\t\telse if( $('form#messageListCompact').length != 0 )\n\t\t{\n\t\t\n\t\t\tif( $('#listFolder', 'form#messageListCompact').attr('value') == folder )\n\t\t\t\t$icon = $('div#' + UID, 'form#messageListCompact').find('#msgIcon')\n\t\t\n\t\t}\n\t\t\n\t\tif( $icon.hasClass('unread') )\n\t\t\t$icon.removeClass('unread')\n\t\t\n\t\tif( !$icon.hasClass('read') )\n\t\t\t$icon.addClass('read')\n\t\t\t\n\t\te.stopPropagation()\n\t\t\n\t})\n\t\n\t$('.nodeActionsButtons #markasunread a', '#messageList').bind('click', function(e) \n\t{\n\t\t$('.nodeActionsButtons .nodeActionsDropdown', '#messageList').hide()\n\t\ticon = $(this).parent().parent().parent().parent().parent().children('#msgIcon')\n\t\t$(icon).removeClass('read')\n\t\tif( !$(icon).hasClass('unread') )\n\t\t\t$(icon).addClass('unread')\n\t\tvar UID = $(this).parent().parent().parent().parent().attr('uniqueid')\n\t\tvar folder = $(this).parent().parent().parent().parent().attr('folder')\n\t\tvar action = moduleBaseUrl + '\/mail\/flagmessage\/flag\/unseen\/appendFlag\/true\/selectFolder\/' + folder + '\/mailId\/' + UID\n\t\t$.php(action)\n\t\t\n\t\t\/\/now try flag in message lists\n\t\t$icon = false\n\t\tif( $('form#messagesListForm').length != 0 ) \/\/2 pane\n\t\t{\n\t\t\t\n\t\t\tif( $('#listFolder', 'form#messagesListForm').attr('value') == folder )\n\t\t\t\t$icon = $('#messageListTable', 'form#messagesListForm').find('tr#' + UID).find('#msgIcon')\n\t\t\t\n\t\t}\n\t\telse if( $('form#messageListCompact').length != 0 )\n\t\t{\n\t\t\n\t\t\tif( $('#listFolder', 'form#messageListCompact').attr('value') == folder )\n\t\t\t\t$icon = $('div#' + UID, 'form#messageListCompact').find('#msgIcon')\n\t\t\n\t\t}\n\t\t\n\t\tif( $icon.hasClass('read') )\n\t\t\t$icon.removeClass('read')\n\t\t\n\t\tif( !$icon.hasClass('unread') )\n\t\t\t$icon.addClass('unread')\n\t\t\n\t\te.stopPropagation()\n\t\t\n\t})\n\t\n\t\n\t\n\tfunction printDOMPart(sourceNode)\n\t{\n\t\tif ( $(sourceNode).find('.messageBody').length > 0 ) \n\t\t{\n\t        \n\t\t\tbody = $(sourceNode).find('.messageBody')\n\t\t\tbody.find('.showQuotedText').next('blockquote').show();\n\t\t\tbody.find('.showQuotedText').remove();\n\t\t\tbodyText = $('<div>').html(html_entity_decode(body.html())).html()\n\t\t\tvar headercc = '';\n\t\t\tif( $('#header-cc', '#messageList').length > 0 )\n\t\t\t\theadercc = \"<h2>Cc: \" + $('#header-cc', '#messageList').html() + \"<\/h2>\";\n\t \t\t\n\t\t\tvar html = \"<HTML>\\n<HEAD>\\n\"+\n\t\t            \"<link rel=\\\"stylesheet\\\" href=\\\"\/css\/reset.css\\\" type=\\\"text\/css\\\" media=\\\"screen, print\\\" \/>\\n\" + \n\t\t            \"<link rel=\\\"stylesheet\\\" href=\\\"\/css\/printMessage.css\\\" type=\\\"text\/css\\\" media=\\\"screen, print\\\" \/>\\n\" + \n\t\t\t\t\t\"<\/HEAD>\\n<BODY style=\\\"padding:10px; overflow:visible;\\\">\"+ \n\t\t            \"<h1>Subject: \" + $('#header-subject', '#messageList').html() + \"<\/h1>\" +\n\t\t            \"<h2>From: \" + $('#header-from', '#messageList').html() + \"<\/h2>\" + \n\t\t\t\t\t\"<h2>To: \" + $('#header-to', '#messageList').html() + \"<\/h2>\" + \n\t\t\t\t\theadercc + \n\t\t\t\t\t\"<h2>\" + $('#header-date', '#messageList').html() + \"<\/h2>\" +\n\t                bodyText\n\t\t\tif( $(sourceNode).find('.attachments').length > 0 )\n\t\t\t\thtml = html + $(sourceNode).find('div.attachments').html()\n\t\t    html = html + \"\\n<\/BODY>\\n<\/HTML>\";\n\t\t\tvar printWindow = window.open(\"\",\"printDOMPart\");\n\t        printWindow.document.open();\n\t        printWindow.document.write(html);\n\t        printWindow.document.close();\n\t        printWindow.print();\n\t    }\n\t}\n\n\t$('.nodeActionsButtons #download a', '#messageList').bind('click', function(e) \n\t{\n\t\t$('.nodeActionsButtonsb.nodeActionsDropdown', '#messageList').hide()\n\t\tvar url = '\/index.php\/mail\/viewmessage\/downloadmessage\/folder\/' + $(this).parent().parent().parent().parent().attr('folder') + '\/uniqueId\/' + $(this).parent().parent().parent().parent().attr('uniqueid')\n\t\t$(this).attr('href',url)\n\t\te.stopPropagation()\n\n\t});\n\t\n\t\/\/ If the reply-all checkbox is ticket on the compose bar\n\t$('#replyAll', '#messageList').bind('change', function() \n\t{ \n\t\n\t\tchecked = $(this).is(':checked')\n\t\tif( checked ) \n\t\t{\n\t\t\t\/\/ Turn the checkbox back on, since the trigger click above set it unchecked\n\t\t\tchecked = $(this).attr('checked', true);\n\t\t\temailTo_handle = updateTextBoxList('#hiddenReplyAllToSource', '#emailTo', autocompleteList);\n\t\t\temailCc_handle = updateTextBoxList('#hiddenReplyAllCcSource', '#emailCc', autocompleteList);\n\t\t}\n\t\telse\n\t\t{\n\t\t\temailTo_handle = updateTextBoxList('#hiddenReplyToSource', '#emailTo', autocompleteList);\n\t\t\temailCc_handle = updateTextBoxList(null, '#emailCc', autocompleteList);\n\t\t}\n\t\temailBcc_handle = updateTextBoxList(null, '#emailBcc', autocompleteList);\n\n\t\t\/\/open recipients section to can see where going to\n\t\t$('#recipientsSection', '#messageList').show();\n\t\t$('#showRecipientsButton', '#messageList').hide();\n\t\t\n\t\t$nodeCheckList = $('#nodeReplyAnchor', '#messageList' )\n\t\t$nodeCheckListLength = $nodeCheckList.length\n\t\tvar i = $nodeCheckListLength-1;\n\t\twhile( $($nodeCheckList[i]).parent().parent().parent().parent().children('.body').html().length < 20 && i >= 0  )\n\t\t\ti--\n\t\tprepResponseFieldsAndContent( $($nodeCheckList[i]).parent(), false )\n\t\t\n\t\t\/\/scroll to bottom\n\t\tscrollToComposer();\n\t\t$('.rte-zone-reply', '#messageList').rte_focus();\n\t\t\t\n\t})\n\n\t$('#back_button #toggleThreads', '#messageList').hide();\n\t$('#back_button #collapseThreads', '#messageList').hide();\n\n\t$('#back_button #toggleThreads', '#messageList').unbind('click').bind('click', function() \n\t{\n\t\t$('#back_button #toggleThreads', '#messageList').hide();\n\t\t$('#back_button #collapseThreads', '#messageList').show();\n\n\t\t$('.message_inner .details', '#messageList').each( function() \n\t\t{\t\t\n\t\t\tif($(this).parent().parent().parent().attr('className') == 'message contracted')\t\n\t\t\t{\n\t\t\t\t$(this).trigger('click');\n\t\t\t}\n\t\n\t\t})\n\t\n\t})    \n\n\t$('#back_button #backToFolder', '#messageList').bind('click', function() \n\t{\n\t\t$('#navMessages').tabs('select',0)\n\t\t$('#nav').tabs('select',0)\n\t})\n\n\t$('#back_button #closeButton', '#messageList').bind('click', function() \n\t{\n\t\tremoveTab( {'name':'#messageList'} );\n\t})\n\n\t$('a.ajax').unbind('click').bind('click', function() \n\t{\n\t   \t$.php( $(this).attr('href') )\n\t\treturn false\n\t\n\t});\n\n\t$('a.ajaxDownload').unbind('click').bind('click', function() \n\t{\n\t\t$(this).removeAttr('target'); \/\/this eliminates (javascript gragefully disables) the flash when firefox opens a new window then closes it when is gets headers indicating a download\t\t\t\n\t\n\t})\n\n    if($(\"div.contracted\", '#messageList').size() > 0)\n\t{\n\t\t$(\"div.message\", '#messageList').scrollTop(0);\n\t\t\n\t}\n\telse\n\t{\n\t\t$(\"#mail_info\", '#messageList').scrollTop(0);\t\n\t\t\n\t}\n\tfunction prepResponseFieldsAndContent( nodeObj, overwrite ) \n\t{\n\t\tif(typeof(overwrite) == 'undefined')\n\t\t\toverwrite = true;\n\t\t\n\t\tif(!overwrite)\n\t\t{\n\t\t\tif($('iframe.rte-zone-reply', '#messageList').contents().find('body').text().length > 1)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t\n\t    \/\/remove click binding\n\t\t$('iframe.rte-zone-reply', '#messageList').contents().unbind('click');\n\t\t\n\t\t\/\/pass the nodeOjb which contains the node structure and field attributes\n\t\t\/\/ N.B. you need this to work around jQuery automagically decoding JSON html entities\n\t\t\/\/$('<div\/>').text( $( nodeObj ).parent().attr('replyto') ).html()\n\t\t\/\/get needed message details for reply \n\t\tvar to         \t\t= $('<div\/>').text( $( nodeObj ).attr('to') ).html()\n\t\tvar replyto    \t\t= $('<div\/>').text( $( nodeObj ).attr('replyto') ).html()\n\t\tvar replyallto \t\t= $('<div\/>').text( $( nodeObj ).attr('replyallto') ).html()\n\t\tvar replyallcc \t\t= $('<div\/>').text( $( nodeObj ).attr('replyallcc') ).html()\n\t\tvar uniqueId   \t\t= $( nodeObj ).attr('uniqueId')\n\t\tvar sent       \t\t= $( nodeObj ).attr('sent')\n\t\tvar subjectOriginal = $('<div\/>').text( $( nodeObj ).attr('subjectOriginal') ).html()\n\t\tvar subjectReply    = $('<div\/>').text( $( nodeObj ).attr('subjectReply') ).html()\n\t\tvar relatedMessageMessageId = $( nodeObj ).attr('relatedMessageMessageId')\n        \n\t\t$('#emailSubject', '#messageList').attr('value', $( nodeObj ).attr('subjectReply') )\n\t\t$('#hiddenReplyToSource', '#messageList').attr('value', replyto)\n\t\t$('#hiddenReplyAllToSource', '#messageList').attr('value', replyallto)\n\t\t$('#hiddenReplyAllCcSource', '#messageList').attr('value', replyallcc)\n\t\t$('#relatedMessageUID', '#messageList').attr('value', uniqueId)\n\t\t$('#relatedMessageMessageId', '#messageList').attr('value', relatedMessageMessageId)\n\n\t\t\/\/set body content to body of node (prepared)\n\n\t\tnodeHeader = '<br \/>----- Original Message -----<br \/>' + getReplyHeader(replyto, to, sent, subjectOriginal, replyallcc)\n\t\tnodeBody = getPreparedReplyBody( $( nodeObj ).parent().parent().parent().children('.body').children('.messageBody') )\n\t\tiframeContentsObject = $('iframe.rte-zone-reply', '#messageList').contents()\n\t\tiframeContentsObject.find('body').html('&nbsp;<BR\/>' + $(\"#EmailSignature.Signature\").html() + '<br \/><blockquote>' + nodeHeader + nodeBody + '<\/blockquote>')\n\n\t\t\/\/open recipients section to can see where going to\n\t\t$('#recipientsSection', '#messageList').show();\n\t\t$('#showRecipientsButton', '#messageList').hide();\n\t}\n\n\tfunction getReplyHeader(from, to, sent, subject, cc) {\n\n\t\tif( cc != undefined)\n\t\t\tccString = '<div id=\"origionalMessageSentField\" style=\"display: inline; font-weight:bold;\">Cc:<\/div>' + cc + '<br \/>'\n\t\telse\n\t\t \tccString = ''\n\t\treturn '<div id=\"origionalMessageFromField\" style=\"width:100%; display: inline; background: rgb(228, 228, 228);\"><div style=\"display: inline; font-weight:bold;\">From:<\/div> ' + from + '<\/div><br \/>' + \n\t\t'<div id=\"origionalMessageToField\" style=\"display: inline; font-weight:bold;\">To:<\/div>' + to + '<br \/>' + \n\t\tccString + '<div id=\"origionalMessageSentField\" style=\"display: inline; font-weight:bold;\">Sent:<\/div>' + sent + '<br \/>' + \n\t\t'<div id=\"origionalMessageSubjectField\" style=\"display: inline; font-weight:bold;\">Subject:<\/div>' + subject + '<br \/>' + \n\t\t'<br \/><br \/>';\n\n\t}\n\n\t\/\/ On the window resize, make the composer neat for the height position\n\t$(window).resize(function()\n\t{\n\t\tif( $.trim( $('iframe.rte-zone-reply', '#messageList').contents().text() ).length > 2 )\n\t\t{\n\t\t\tresizeComposer('messageList', true, false);\n\t\t}\n\t\t\n\t\t\/\/resize any iframes\n\t\t$('iframe.messageIframe').each(\n\t\t\tfunction()\n\t\t\t{\n\t\t\t\tprepMessageIframeHeight( $(this) );\n\t\t\t}\n\t\t)\n\t});\n    \n\tresizeComposer('messageList');\n\t\n\t$('#back_button #collapseThreads', '#messageList').unbind('click').bind('click', function() \n\t{\n\t\t$('#back_button #collapseThreads', '#messageList').hide();\n\t\t$('#back_button #toggleThreads', '#messageList').show();\n\n\t\t$('.message_inner .details', '#messageList').each( function() \n\t\t{\t\t\n\t\t\tif($(this).parent().parent().parent().attr('className') != 'message contracted')\t\n\t\t\t{\n\t\t\t\t$(this).trigger('click');\n\t\t\t}\n\t\n\t\t})\n\t\n\t})  \n\t\n\n\t\/\/now bind a scroll updater to update stored scroll position so we can refer back to it when switching tabs beck to this one\n\t\/\/2 pane\n\t$('#primary_content', '#messageList').data('OldScrollPos', 0);\n\t$('#primary_content', '#messageList').bind('scroll', function() { $(this).data('OldScrollPos', $(this).scrollTop()) })\n\t\/\/3 pane\n\t$('#mail_info', '#messageList').each( function() \n\t{ \n\t\n\t\t$(this).data('OldScrollPos', 0);\n\t\t$(this).bind('scroll', function() { $(this).data('OldScrollPos', $(this).scrollTop()) })\n\t\n\t})\n\n})\n\nfunction tryAutoSaveInlineDraft(context)\n{\n\n\t\/\/for compact case context must check against UID so we know we still editing the same UID\n\tvar killme = false;\n\tif( $(context).length == 0 )\n\t\tkillme = true\n\telse\n\t{\t\n\t\tvar UID = $('#relatedMessageUID', context).attr('value')\n\t\tvar UIDCurrent = window.periodicDraftSavers[context + 'UID'] || false\n\t\tif( UID != UIDCurrent || !$('.reply:last', context).is(':visible') )\n\t\t\tkillme = true\n\t}\t\n\tif( killme )\n\t{\n\n\t\tclearInterval(window.periodicDraftSavers[context])\n\t\twindow.periodicDraftSavers[context + 'UID'] = null\n\t\treturn\n\n\t}\n\tvar html = $('.rte-zone-reply', '#messageList').rte_html()\n    $(\"#id_desc_messageList\").attr('value', html)\n\t$.php( '\/index.php\/mail\/composemessage\/savedraft\/auto\/true', $('#composeMessage', '#messageList' ).serializeArray() ) \n\t\n}\n\nfunction draftAutosavingInitialize(context, uid)\n{\n\n\t\/\/regularly save draft\n\twindow.periodicDraftSavers = window.periodicDraftSavers || [] \/\/create the array if it doesnt exist\n\tif( window.periodicDraftSavers[context] != undefined )\n\t{\n\n\t\tclearInterval(window.periodicDraftSavers[context])\n\t\twindow.periodicDraftSavers[context + 'UID'] = null\n\n\t}\n\twindow.periodicDraftSavers[context + 'UID'] = uid\n\twindow.periodicDraftSavers[context] = setInterval( function() { tryAutoSaveInlineDraft(context) }, 120000);\n\n\t\/\/save first draft soon after opening composer\n\tsetTimeout( function() { tryAutoSaveInlineDraft(context) }, 30000);\n\n}\n\n<\/script>\n"]]},{"s":"#errors","m":["html"],"a":[[""]]},{"s":"#notices","m":["html"],"a":[[""]]},{"s":"#debug","m":["html"],"a":[[false]]}]}